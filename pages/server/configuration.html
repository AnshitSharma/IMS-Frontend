<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Configuration - BDC IMS</title>
    <link rel="stylesheet" href="../../assets/css/tailwind.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-surface-main">
    <!-- Shared Navigation Header -->
    <div id="navbar-placeholder"></div>

    <!-- Main Configuration Container -->
    <!-- Component Sidebar (injected dynamically, hidden on desktop for this page) -->
    <div id="sidebar-placeholder" class="hidden lg:hidden"></div>

    <div class="flex min-h-[calc(100vh-64px)]">
        <!-- Mobile Filter Button -->
        <button
            class="fixed bottom-20 right-4 lg:hidden bg-primary text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center z-40"
            id="mobile-filter-btn">
            <i class="fas fa-filter"></i>
        </button>

        <!-- Filter Overlay for Mobile -->
        <div class="filter-overlay fixed inset-0 bg-black/50 z-30 hidden"></div>

        <!-- Left Sidebar Filter Panel -->
        <aside
            class="config-sidebar w-72 min-w-[288px] bg-surface-card border-r border-border-light overflow-y-auto flex-shrink-0 h-[calc(100vh-64px)] sticky top-16"
            id="config-sidebar">
            <!-- Mobile Filter Header -->
            <div class="lg:hidden flex items-center justify-between px-4 py-3 border-b border-border-light">
                <h3 class="font-semibold text-text-primary">Filters</h3>
                <button class="mobile-filter-close text-text-disabled hover:text-text-muted">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <!-- Part List Section -->
            <div class="p-4 border-b border-border-light">
                <div class="flex items-center gap-2 mb-3">
                    <i class="fas fa-list text-primary"></i>
                    <h3 class="font-semibold text-text-primary text-sm">Part List</h3>
                </div>
                <label class="flex items-center gap-2 cursor-pointer mb-4">
                    <input type="checkbox" id="compatibilityFilter" checked class="w-4 h-4 accent-primary">
                    <span class="text-sm text-text-secondary">Compatibility Filter</span>
                </label>
                <div class="bg-surface-main rounded-lg p-3">
                    <div class="flex items-center justify-between">
                        <span class="text-xs font-semibold text-text-muted uppercase">PARTS</span>
                        <span class="text-xl font-bold text-text-primary" id="partsCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Filters Section - Dynamically generated by JavaScript -->
            <div class="filters-section p-4">
                <!-- Filters will be loaded dynamically based on component type -->
            </div>

            <!-- Mobile Filter Footer -->
            <div class="lg:hidden px-4 py-3 border-t border-border-light mt-auto">
                <button
                    class="mobile-filter-apply w-full bg-primary text-white py-2.5 rounded-lg hover:bg-primary-600 transition-colors font-medium">Apply
                    Filters</button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col min-h-[calc(100vh-64px)] overflow-hidden">
            <!-- Header -->
            <div class="bg-surface-card border-b border-border-light px-6 py-4">
                <div class="flex items-center gap-4 mb-4">
                    <button
                        class="flex items-center gap-2 px-4 py-2 bg-surface-secondary text-text-secondary rounded-lg hover:bg-surface-hover transition-colors text-sm font-medium"
                        id="backButton">
                        <i class="fas fa-arrow-left"></i>
                        <span>Back to Builder</span>
                    </button>
                    <h1 class="text-2xl font-bold text-text-primary" id="pageTitle">Choose A CPU</h1>
                </div>
                <div class="flex flex-wrap items-center gap-3">
                    <div
                        class="flex items-center gap-2 bg-surface-main px-4 py-2.5 rounded-lg flex-1 max-w-md border border-border-light">
                        <i class="fas fa-search text-text-disabled"></i>
                        <input type="text" id="componentSearch" placeholder="Search CPUs..."
                            class="bg-transparent border-none outline-none text-sm flex-1 text-text-primary placeholder:text-text-disabled">
                    </div>
                    <button
                        class="px-5 py-2.5 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary-600 transition-colors"
                        id="addFromFilter">
                        Add From Filter
                    </button>
                </div>
            </div>

            <!-- Component Count & Selection -->
            <div class="px-6 py-3 bg-surface-main border-b border-border-light flex items-center justify-between">
                <span id="componentCount" class="text-sm text-text-secondary font-medium">0 Compatible Products</span>
                <div class="flex gap-2">
                    <button
                        class="px-4 py-1.5 bg-surface-card border border-border-light text-text-secondary rounded-lg hover:bg-surface-hover transition-colors text-sm font-medium"
                        id="selectAll">Select All</button>
                    <button
                        class="px-4 py-1.5 bg-surface-card border border-border-light text-text-secondary rounded-lg hover:bg-surface-hover transition-colors text-sm font-medium"
                        id="selectNone">Select None</button>
                </div>
            </div>

            <!-- Component List Table -->
            <div class="flex-1 p-6 pb-20 overflow-y-auto">
                <div class="bg-surface-card border border-border-light rounded-xl shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead id="componentListHeader" class="bg-surface-secondary">
                                <!-- Headers will be loaded dynamically -->
                            </thead>
                            <tbody id="componentList" class="divide-y divide-border-light">
                                <!-- Components will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Compatibility Warning Banner (Fixed at bottom like image 0) -->
    <div class="fixed bottom-0 left-0 right-0 bg-warning-50 border-t-4 border-warning px-6 py-3 shadow-lg z-50 hidden"
        id="compatibilityBanner">
        <div class="max-w-screen-xl mx-auto flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-warning rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                </div>
                <span id="bannerMessage" class="text-sm font-medium text-warning-900">Note: 1 component(s) are not
                    compatible with your current configuration</span>
            </div>
            <div class="flex items-center gap-3 flex-shrink-0">
                <button
                    class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary-600 transition-colors"
                    id="viewDetails">View Details</button>
                <button
                    class="px-4 py-2 text-text-secondary hover:text-text-primary text-sm font-medium transition-colors"
                    id="dismissBanner">Dismiss</button>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer" class="alert-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="../../components/global-loading.js"></script>
    <script src="../../assets/js/toast.js"></script>
    <script src="../../assets/js/dashboard/utils.js"></script>
    <script src="../../assets/js/dashboard/api.js"></script>
    <!-- Sidebar Component and Manager (must load before navbar) -->
    <script src="../../components/sidebar-manager.js"></script>
    <script>
        // Load sidebar HTML into placeholder
        async function loadSidebarComponent() {
            try {
                const response = await fetch('../../components/sidebar.html');
                const html = await response.text();
                document.getElementById('sidebar-placeholder').innerHTML = html;
                // Reinitialize sidebar manager after HTML loads
                if (window.sidebarManager) {
                    // Use reinitMobileMenu to setup handlers after sidebar is loaded
                    window.sidebarManager.reinitMobileMenu();
                    const counts = await window.sidebarManager.getComponentCounts();
                    window.sidebarManager.updateSidebarCounts(counts);
                }
            } catch (error) {
                console.error('Failed to load sidebar component:', error);
            }
        }
        // Store promise globally
        window.sidebarReady = loadSidebarComponent().catch(err => {
            console.error('Sidebar loading error:', err);
            return null;
        });
    </script>
    <script src="../../components/navbar.js"></script>
    <script src="../../assets/js/server/server-api.js"></script>
    <script src="../../assets/js/server/configuration.js"></script>
</body>

</html>